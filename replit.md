# Financial Document Analysis Platform

## Обзор проекта

Профессиональная платформа для интеллектуального анализа финансовых документов с использованием AI. Поддерживает загрузку Excel (.xlsx, .xls), Word (.docx) и PDF файлов с финансовыми данными и обеспечивает автоматический расчёт ключевых финансовых коэффициентов с детальным анализом от OpenAI GPT-5 (с fallback на rule-based анализ).

## Последние изменения

**28 октября 2025** - Расширена поддержка форматов файлов
- ✅ Добавлена поддержка парсинга DOCX файлов (mammoth)
- ✅ Добавлена поддержка парсинга PDF файлов (pdf-parse)
- ✅ Реализован универсальный document parser с dual parsing strategy:
  - Multi-line формат: Поле → Код (4 цифры) → Значение (на отдельных строках)
  - Single-line формат: Поле Код Значение1 Значение2 (на одной строке)
- ✅ Улучшена обработка чисел: нули, отрицательные значения, скобки, разделители
- ✅ Расширены списки синонимов для российской бухгалтерской отчётности
- ✅ Протестировано на реальном DOCX файле бухгалтерской отчётности
- ✅ Frontend обновлён для приёма всех форматов с валидацией

**25 октября 2025** - Инициализация проекта
- Создана схема данных для финансового анализа (shared/schema.ts)
- Реализованы все основные компоненты frontend
- Настроена дизайн-система с профессиональным финансовым стилем
- Добавлена поддержка тёмной темы
- Интегрирована библиотека Recharts для визуализации данных

## Основные возможности

### Реализованные функции
- ✅ Drag-and-drop загрузка файлов (.xlsx, .xls, .docx, .pdf) - до 10 МБ
- ✅ Парсинг Excel файлов с гибким поиском полей (server/excel-parser.ts)
- ✅ Парсинг DOCX файлов с извлечением текста через mammoth
- ✅ Парсинг PDF файлов с извлечением текста через pdf-parse
- ✅ Универсальный document parser с dual parsing strategy
- ✅ Предварительный просмотр загруженных финансовых данных
- ✅ Расчёт и отображение коэффициентов ликвидности (текущей, быстрой, абсолютной)
- ✅ Расчёт показателей финансовой устойчивости (автономии, задолженности, финансового рычага)
- ✅ Интеграция с OpenAI GPT-5 для AI-анализа с graceful fallback
- ✅ Секция AI-анализа с сильными сторонами, слабостями и рекомендациями
- ✅ Интерактивная визуализация данных (столбчатые диаграммы, радар-чарт)
- ✅ Красивые состояния загрузки с прогресс-баром и этапами обработки
- ✅ Адаптивный дизайн для всех размеров экранов
- ✅ Тёмная/светлая тема

### В разработке
- ⏳ Экспорт отчётов в PDF/Excel (будущее развитие)
- ⏳ История анализов с сохранением
- ⏳ Поддержка дополнительных форматов отчётности

## Архитектура проекта

### Структура данных (shared/schema.ts)
- `FinancialData` - данные из загруженного Excel файла (активы, пассивы, капитал)
- `FinancialRatios` - рассчитанные финансовые коэффициенты
- `RatioWithStatus` - коэффициент с оценкой статуса (excellent/good/warning/critical)
- `FinancialAnalysisResult` - полный результат анализа включая AI-выводы

### Frontend компоненты

**Основные компоненты:**
- `Home` (pages/home.tsx) - главная страница приложения
- `FileUpload` - компонент загрузки файлов с drag-and-drop
- `DataPreview` - таблица предварительного просмотра данных
- `RatioCard` - карточка финансового коэффициента с цветовой индикацией
- `AIAnalysis` - секция AI-анализа с рекомендациями
- `VisualizationCharts` - графики визуализации (Bar, Radar)
- `LoadingModal` - модальное окно с прогрессом обработки

**UI компоненты (shadcn):**
- Все стандартные компоненты shadcn/ui доступны в `components/ui/`
- Кастомизированы цвета для финансового стиля (синий primary, серый secondary)

### Backend
**API Routes (server/routes.ts):**
- `POST /api/analyze` - загрузка и анализ финансовых файлов (.xlsx, .xls, .docx, .pdf)
- `GET /api/template` - скачивание шаблона Excel файла

**Парсеры:**
- `excel-parser.ts` - парсинг Excel с гибким поиском полей, синонимами и нормализацией
- `document-parser.ts` - универсальный парсер DOCX/PDF с dual parsing:
  - Multi-line: "Поле → Код (4 цифры) → Значение" на разных строках
  - Single-line: "Поле Код Значение1 Значение2" на одной строке
  - Автоматический fallback между стратегиями
  
**Обработка чисел:**
- Поддержка нулевых значений
- Отрицательные числа (минус и в скобках)
- Разделители тысяч (пробелы, запятые, неразрывные пробелы)
- Десятичные разделители

**Финансовый калькулятор (server/financial-calculator.ts):**
- Коэффициенты ликвидности (текущей, быстрой, абсолютной)
- Коэффициенты финансовой устойчивости (автономии, задолженности, финансового рычага)
- Рентабельность собственного капитала (ROE)

**OpenAI интеграция (server/openai.ts):**
- Генерация AI-анализа через GPT-5
- Graceful fallback на rule-based анализ при ошибках API
- Валидация данных с использованием Zod схем

## Технологический стек

### Frontend
- **React 18** - UI библиотека
- **TypeScript** - типизация
- **Vite** - сборщик и dev server
- **Tailwind CSS** - стилизация
- **shadcn/ui** - компонентная библиотека
- **Recharts** - визуализация данных
- **React Query** - управление состоянием и запросами
- **Wouter** - маршрутизация
- **Lucide React** - иконки

### Backend
- **Express.js** - веб-сервер
- **Multer** - загрузка файлов (до 10 МБ)
- **XLSX** - парсинг Excel файлов (.xlsx, .xls)
- **Mammoth** - извлечение текста из DOCX файлов
- **pdf-parse** - извлечение текста из PDF файлов
- **OpenAI SDK** - интеграция с GPT-5 (с fallback)
- **Zod** - валидация данных

## Дизайн система

### Цветовая палитра
- **Primary**: Синий (#2563eb) - для кнопок, акцентов, графиков
- **Secondary**: Серый - для вторичных элементов
- **Success**: Изумрудный - для положительных показателей
- **Warning**: Янтарный - для предупреждений
- **Destructive**: Красный - для критических показателей

### Типографика
- **Sans**: Inter - основной шрифт для текста и UI
- **Mono**: JetBrains Mono - для финансовых цифр и данных

### Spacing
Используется консистентная система отступов:
- Micro (UI elements): 2, 4
- Component spacing: 6, 8
- Section padding: 12, 16, 20

## API секреты

### Переменные окружения
- `OPENAI_API_KEY` - ключ API для OpenAI (настроен через Replit Secrets)

## Инструкции по разработке

### Запуск проекта
```bash
npm run dev
```
Запускает Express сервер (backend) и Vite dev server (frontend) на одном порту.

### Установка зависимостей
Используйте packager_tool вместо прямого `npm install`.

### Стилевые правила
- Следовать design_guidelines.md для всех UI изменений
- Использовать существующие shadcn компоненты
- Применять классы hover-elevate и active-elevate-2 для интерактивных элементов
- Обеспечивать контраст для тёмной темы
- Все интерактивные элементы должны иметь data-testid атрибуты

### Работа с формами
- Использовать react-hook-form через shadcn Form компоненты
- Валидировать с помощью zod schemas из shared/schema.ts
- Показывать понятные сообщения об ошибках

## Roadmap

### Фаза 1: MVP (завершена ✅)
- ✅ Frontend компоненты и дизайн
- ✅ Backend обработка Excel, DOCX и PDF файлов
- ✅ Интеграция OpenAI с fallback механизмом
- ✅ Подключение frontend к backend
- ✅ End-to-end тестирование с реальными документами

### Фаза 2: Расширенные возможности
- Расчёт показателей рентабельности и деловой активности
- Сравнительный анализ нескольких периодов
- Экспорт отчётов в PDF и DOCX
- История анализов с сохранением

### Фаза 3: Продвинутые функции
- Прогнозирование финансовых показателей с AI
- Шаблоны для разных типов отчётности
- Бенчмаркинг по отраслям
- Командная работа и комментарии

## Примечания

- Проект использует in-memory хранилище (MemStorage) согласно fullstack_js guidelines
- Дизайн оптимизирован для профессионального финансового использования
- Все компоненты адаптивны и работают на мобильных устройствах
- Поддержка тёмной темы обязательна для всех новых компонентов
